Key differences from ZPAQ 7.15 and zpaqfranz

First goal: doveryay, no proveryay (trust, but verify).
As a storage manager I need to be sure that my backups
are perfect, so verify is the objective of my zpaq fork.

Second: do not break compatibility with 7.15.

Third: more useful output.

Fourth: pack everything needed for a storage manager
(compare directories, hashing, duplicate find,
fix of utf-8 filenames, wiping etc) in a single
program

---
add()

zpaqfranz (for default) store the CRC-32 of the files
added.
zpaq does not have a mechanism to check the integrity
of the stored files: it do a (smart) "chunk"-SHA1 verify
Cannot do a "heavy" test (ex. recomputing SHA1 of the entire file)
because of it design.
With the CRC32 you are sure against SHA1 collision
(better: the collision will be noted, not fixed).
With an optional switch (-checksum) you can also store 
the SHA1 hash code (slower, but almost 100% sure.
In future different [faster] hashes)
With the switch -crc32 it is possible 
to disable the storage of the control code 
going back to the operation of 7.15
Warning: the calculation of the CRC-32, 
especially on modern processors, 
does not significantly slow down the process. 
The calculation of SHA1, on the other hand, 
requires a longer time.
-test do a post-add test
Now, for default, do NOT store ACLs on Windows
(-forcewindows)

By default every .XLS file is forcibily added.
Check of datetime is not reliable for ancient 
XLS to detect changes. 
If you have lots of old XLS edited (for example)
by Excel 2000, a binary (or hash) check of extracted
files will fail.
Yeah I know, it's strange, but Excel can change some
bytes into XLS files (to update last time) without
"touch".
This was the first step for zpaqfranz, 
I went crazy to discover this amazing behavior of Excel
Can be disabled by -xls (=7.15)

Volume Shadow Copies (Windows, with administrative rights)
Create a VSS (DELETING ALL OTHER PRESENTS!) then make
the backup, typycally for a "utente" into "users", like that
zpaqfranz a c:\2.zpaq c:\Users\utente\ -vss

Progress information is shown during the extraction phase, 
which can be modified by the switches -noeta, -verbose, -pakka, -debug, summary,
-n x

ASCII comment for versions
Using the switch -comment sometext 
it is possible to mark the current version 
of the archive with "sometext". 
This will make it easier for you to search or extract.
Warning: the text should not contain spaces or 
non-ASCII characters and, above all, be unique. 
There is no duplication check on version comments. 
If you add the same comment more than once, 
you will not be able to use it later to extract the data. 
This remains possible through the normal use of -until

e (extract)
During extraction if the control information (CRC32) 
is present, as in the default setting, 
at the end of the extraction, 
the codes are calculated to verify that the files 
have been correctly extracted. 
-checksum the extracted files will be re-read and the code verified. 
It is a measure that lengthens the times but increases safety.
-kill extract to dummy, 0-length files. Simulate a full restore
(useful for strange filenames)
sometimes it's impossible to restore a *nix archive on Windows,
for various reason.
Path too long and too "strange" filenames.
That's really bad (cannot restore data), so there are some
new switches
-utf change everything non latin to latin
-fix255 shrink to 255 max length, avoid same case collision
-fixeml compress .eml filenames
-flat emergency restore of everything into a single folder

Command l (list)
With files run a compare (check) of the archive's 
content against one or more directory.
In fact this is a "verify" more than a "list"
The comparison is much faster than the standard, 
as it only performs a block calculation of the SHA1 codes 
of the file present in the filesystem, 
while those archived are not extracted. 
It also checks the CRC-32, 
to intercept any (very rare) SHA1 collisions.
After add() you can list() with just the same
parameter and do a very quick (but safe)
verify
It's possible to search by -comment,
filter -find pippo (just like |grep -i pippo),
-replace pluto replace "pippo" with "pluto"

New command t (test)
Compared to 7.15, not only is it checked 
that the blocks are extractable, 
but also that the CRC-32 code of the individual 
files corresponds to what would be generated 
by actually extracting the data
-verify for filesystem post-check

With this switch the files are reread, one by one, 
from the filesystem and compared. 
Typically it is used in case of a simulated recovery, 
to be sure that the extracted files are identical, 
beyond any doubt, to the original ones.



New command p (paranoid test)
Test the archive content in a very paranoid fashion.
The ZPAQ reference decompressor is used to extract 
the various blocks in RAM and check them. 
Essentially it is similar to extracting 
the entire archive into a temporary folder. 
The amount of RAM can quickly become unmanageable. 
Doesn't support multifile _ ????. 
Shows an estimate of the RAM used (not very early) during the operation.
For each file will output the SHA1 of the virtually extracted one.
It is normally used in combination with add() -checksum, 
which stores the SHA1 codes, to make a comparison.
It warns on win32 systems (with RAM limits) and refuses to run on ESXi
-verify next level of paranoia: check SHA1 against a re-read from filesystem. 
Essentially it is equivalent to extracting the contents 
of the archive in a temporary folder, 
and then checking that the SHA1 codes correspond 
to those present in the initial folder and that, 
finally, they are the same ones stored in the archive 
(if you use -checksum during the by add).

New command c (compare dirs)
Compare a "master" directory (d0) against N "slaves" (d1, d2, dN).
In the world of professional archiving it is normal to have a source (master) 
directory copied, with different mechanisms, to multiple destination (slave)
directories.
Usually some of these folders will be (*nix) NFS or SMB mountpoints, 
which you copy to with rsync, zfs-replica, robocopy for Windows etc.
Or, in the case of zpaqfranz or 7z or rar, by e extracting a backup inside 
a temporary folder.
How can you be sure that all the master files are in the slaves, 
and that there are no more files in the slaves than the master?
Especially with the use of utf8 names 
(non-Latin, often incompatible between UNIX-zfs and Linux-ext4) 
and path lengths> 260 (for NTFS)?
And if you have some zfs' snapshot in the path?
zpaqfranz c c:\nz z:\nz r:\nz
In this example the "master" (or source) dir is c:\nz, 
and the slaves are z:\nz and r:\nz
Without further options, the control is done on the file name and size, 
not on the content, 
and is essentially designed for copies on NAS and similar devices.
-all N concurrent threads will be created, each scan a slave dir.
It is used to operate in parallel comparing an original folder with 
multiple copies on different devices, minimizing the scan time
-verify will run a hash check: it has the function of diff -qr

New command s (size)
Return cumulative size of N directory, 
and an estimate of the free space on its filesystem.
Everything containing .zfs in filename will be ignored
It is used for a quick check of synchronized folders: 
there is no easy way, in UNIX / Linux, to immediately 
know how big a folder with subfolders is.
Similarly it is not easy, on UNIX / Linux, 
to have an idea at least indicative of the free space on devices.
-all N concurrent threads will be created, each scan a slave dir.It is used to operate in parallel on different devices, minimizing the scan time

New command sha1 (hashes)
Calculate SHA1 (or other hashes) of files/directories, and candidate duplicates,
and cumulative GLOBAL SHA256 (hash of hashes).
Two == directories have the same GLOBAL 
-xxhash one of checksum/hashes algorithm
-crc32 one of checksum/hashes algorithm
-crc32c one of checksum/hashes algorithm
-sha256 one of checksum/hashes algorithm
-all make N thread (do not use with spinning HDDs, but SSDs and NVMes)
-kill show the files to be deleted to deduplicate
-checksum get a 1-level checksum
-summary show only GLOBAL


New command dir
If there's one thing I hate about UNIX and Linux in general it's the ls command, 
as opposed to Windows dir, because it do not show the cumulative filesize (!)
How big is folder c:\nz, with subdirs?
zpaqfranz dir c:\nz /s -n 1 
zpaqfranz dir c:\nz /s |tail -2
This is a kind of mini clone, to be used with a shell alias for convenience.
Main switch are /s, /os, /on, /a, -n X like tail -n
Can also find duplicate files (-crc32 or -crc32c)
just about like rar a -oi3:1 -r dummy s:\
zpaqfranz dir r:\minc\2 /s -crc32 -n 100
will show the 100 biggest duplicate file in r:\minc\2
zpaqfranz dir r:\minc\2 /s /os -n 10
will show the 10 biggest file in r:\minc\2

New command i (info)
Show the versions of a ZPAQ, just like (for zpaqfranz) l -all -comment
with size (and comments, if any)

New command utf (deal with strange filenames)
Check (or sanitize) paths with non-latin chars and/or
>260 length
-dirlength X (set the "fix")
-filelength Y 
-utf (sanitize filename)
-fix255 (sanitize file length and filecase)
-fixeml (sanitize .eml filenames)
-kill (do the fix=> convert to latin)

New command f (fill, or wipe)
Fill (wipe) almost all disk space and check that the datas is well
written, in chunks of 500MB (pseudorandum), onto the new
ztempdir folder
Two use: wipe (clear) the space with uncompressible data,
check if disk-controller-system-RAM is working fine
-verbose show write speed (useful to check speed consistency)
-kill delete (after run) the temporary filename

New command k (kill)
kill (delete) all files and directories that arent in archive
example:
zpaqfranz a z:\1.zpaq c:\nz
zpaqfranz x z:\1.zpaq c:\nz -to z:\knb
... something happens in z:\knb and we want to turn back to archive ...
... WITHOUT delete everything and extract again ..."
zpaqfranz x z:\1.zpaq c:\nz -to z:\knb -force"
zpaqfranz k z:\1.zpaq c:\nz -to z:\knb"

New command/switches 
During the automated executions, scripts can be launched 
to send warnings (e.g. failure or OK)
-exec_ok fo.bat After OK launch fo.bat
-exec_error kz  After NOT OK launch kz

New commands / switches for help
help           long help
-h             long help
-he            show examples
-diff          differences against 7.15


Various switches
-summary        Changed: if >0 => only summary
-noeta          do not show ETA (for script)
-pakka          concise output
-verbose        not so concise
-zfs            Skip path including .zfs (for ZFS snapshots)
-noqnap         Skip path including @Recently-Snapshot and @Recycle
-forcewindows   Take $DATA$ and System Volume Information
-xls            Do NOT always force XLS
-nopath         Do not store path
-nosort         Do not sort file when adding or listing
-find X         Search for X in full filename (ex. list)
-replace    Y   Replace X with Y in full filename (ex. list)
-n          X   Only print last X lines in dir (like tail)/first X (list)
-limit      X   (like -n)
-minsize    X   Skip files by length (add(), list(), dir())
-maxsize    X   Skip files by length (add(), list(), dir())
-filelength X   Utf command: find file with length>X, extract maxfilelen
-dirlength  X   Utf command: find dirs with length>X, extract maxdirlen
-comment foo    Add/find ASCII comment string to versions
-vss            Do a VSS for drive C: (Windows with administrative rights)
-crc32c         In hash command use CRC32c
-crc32          In hash command use CRC32
-xxhash         In hash command use XXH3
-sha256         In hash command use SHA256
-exec_ok fo.bat After OK launch fo.bat
-exec_error kz  After NOT OK launch kz
-kill           Show 'script-ready' log of dup files
-kill           In extraction write 0-bytes file instead of data
-utf            Remove non-utf8 chars
-utf8           Like -utf
-fix255         Shrink total file length and case collisions (NTFS)
-fixeml         Heuristically compress .eml filenames (Fwd Fwd Fwd =>Fwd)
-flat           Everything in single path (emergency extract of strange files)
-debug          Show lot of infos (superverbose)




